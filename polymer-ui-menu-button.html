<!--
Copyright 2013 The Polymer Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<!--
/**
 * @module Polymer Elements
 */
-->
<link rel="import" href="../../polymer-elements/polymer-anchor-point/polymer-anchor-point.html">
<link rel="import" href="../../polymer-elements/polymer-media-query/polymer-media-query.html">
<link rel="import" href="../../polymer-elements/polymer-overlay/polymer-overlay.html">
<link rel="import" href="../polymer-ui-icon-button/polymer-ui-icon-button.html">
<link rel="import" href="../polymer-ui-menu/polymer-ui-menu.html">
<link rel="import" href="../polymer-ui-arrow/polymer-ui-arrow.html">

<polymer-element name="polymer-ui-menu-button" attributes="src icon opened responsive halign valign selected selectedItem selectedClass valueattr multi">
  <template>
    <link rel="stylesheet" href="polymer-ui-menu-button.css">
		<polymer-ui-icon-button id="button" on-tap="toggle" src="{{src}}" icon="{{icon}}" active="{{opened}}" anchor-point="{{valign}}"></polymer-ui-icon-button>
		<div id="overlay" halign="{{halign}}" valign="{{valign}}">
			<div id="overlayMenu">
				<polymer-ui-menu id="menu" selected="{{selected}}" selectedItem="{{selectedItem}}" selectedClass="{{selectedClass}}" valueattr="{{valueattr}}" multi="{{multi}}">
					<content select="*"></content>
				</polymer-ui-menu>
			</div>
      <polymer-ui-arrow id="arrow" size="9" direction="{{valign == 'top' ? 'down' : 'up'}}" anchor-point="center center"></polymer-ui-arrow>
		</div>
		<polymer-media-query query="{{mediaQuery}}" on-polymer-mediachange="mediaChangeAction"></polymer-media-query>
		<polymer-anchor-point id="arrowPositionHelper" target="{{$.arrow}}" anchor="{{$.button}}"></polymer-anchor-point>
		<polymer-overlay target="{{$.overlay}}" opened="{{opened}}"></polymer-overlay>
  </template>
  <script>
    Polymer('polymer-ui-menu-button', {
      icon: 'dots',
      src: '',
      selected: '',
      opened: false,
      halign: 'center',
			valign: 'bottom',
      multi: false,
			mediaQuery: 'max-width: 800px',
			openedChanged: function() {
				this.async(function() {
					this.$.arrowPositionHelper.apply();
				});
			},
			mediaChangeAction: function(e) {
				if (e.detail.matches) {
					this.classList.add('fullwidth');
				} else {
					this.classList.remove('fullwidth');
				}
			},
      //* Toggle the opened state of the dropdown.
      toggle: function() {
        this.opened = !this.opened;
      },
      //* Returns the selected item.
      get selection() {
        return this.$.menu.selection;
      }
    });
  </script>
</polymer-element>
